[gd_scene load_steps=11 format=3 uid="uid://lcpnouh2lsen"]

[ext_resource type="PackedScene" uid="uid://i6qromh3258a" path="res://scenes/objects/animated_light/animated_light.tscn" id="1_m3vai"]
[ext_resource type="Shader" uid="uid://b44et88d68510" path="res://resources/shaders/pixel_toon.gdshader" id="2_3wdb4"]

[sub_resource type="Shader" id="Shader_k7p2f"]
code = "// NOTE: Shader automatically converted from Godot Engine 4.2.2.stable's StandardMaterial3D.

shader_type spatial;
render_mode blend_mix,depth_draw_opaque,cull_back;
uniform sampler2D texture_albedo : source_color,filter_linear_mipmap,repeat_enable;
varying vec3 uv1_triplanar_pos;
uniform float uv1_blend_sharpness;
varying vec3 uv1_power_normal;
uniform vec3 uv1_scale;
uniform vec3 uv1_offset;


global uniform vec4 background_color: source_color;
global uniform vec4 border_color: source_color;
global uniform vec4 darker_border_color: source_color;


uniform bool custom_colors = false;

uniform vec3 color_0 : source_color;
uniform vec3 color_1 : source_color;
uniform vec3 color_2: source_color;

uniform float dim: hint_range(0.0, 1.0, 0.1) = 1.0;


void vertex() {
	vec3 normal = MODEL_NORMAL_MATRIX * NORMAL;
	uv1_power_normal=pow(abs(normal),vec3(uv1_blend_sharpness));
	uv1_triplanar_pos = (MODEL_MATRIX * vec4(VERTEX, 1.0f)).xyz * uv1_scale + uv1_offset;
	uv1_power_normal/=dot(uv1_power_normal,vec3(1.0));
	uv1_triplanar_pos *= vec3(1.0,-1.0, 1.0);
}



vec4 triplanar_texture(sampler2D p_sampler,vec3 p_weights,vec3 p_triplanar_pos) {
	vec4 samp=vec4(0.0);
	samp+= texture(p_sampler,p_triplanar_pos.xy) * p_weights.z;
	samp+= texture(p_sampler,p_triplanar_pos.xz) * p_weights.y;
	samp+= texture(p_sampler,p_triplanar_pos.zy * vec2(-1.0,1.0)) * p_weights.x;
	return samp;
}


vec3 fix_colors(vec3 col){
	return mix(pow((col + vec3(0.055)) * (1.0 / (1.0 + 0.055)), vec3(2.4)), col * (1.0 / 12.92), lessThan(col, vec3(0.04045)));
}


vec3 get_new_tex(vec3 tex){
	if (distance(tex, vec3(0.066)) < 0.001){
		return fix_colors(background_color.rgb);
	}
	
	if (distance(tex, vec3(0.219)) < 0.001){
		return fix_colors(border_color.rgb);
	}
	
	if (distance(tex, vec3(0.168)) < 0.001){
		return fix_colors(darker_border_color.rgb);
	}
	
	return tex;
}






void fragment() {
	vec4 albedo_tex = triplanar_texture(texture_albedo,uv1_power_normal,uv1_triplanar_pos);
	albedo_tex.rgb = get_new_tex(albedo_tex.rgb);
	
	ALBEDO.rgb = albedo_tex.rgb;
}



void light() {
	float lig = pow(ATTENUATION, 2.0);
	//lig = round(lig * 3.0) / 3.0;
	vec3 albe = mix(vec3(0.0), ALBEDO.rgb + vec3(lig * 0.03), lig * 0.9);
	albe *= dim;
	
	vec3 new_albedo_tex;
	
	vec3 palette[] = {
		fix_colors(background_color.rgb),
		fix_colors(border_color.rgb),
		fix_colors(darker_border_color.rgb)
		}; // Can be any list of RGB colors, but there must be at least one.
	
	if (custom_colors){
		palette = {
			color_0,
			color_1,
			color_2
		};
		}
	
	vec3 new_color = palette[0];
	for (int i = 0; i<palette.length(); i++){
		if (distance(palette[i],albe) < distance(new_color, albe)){
			new_color = palette[i];
		}
		new_albedo_tex = new_color;
	}
	
	SPECULAR_LIGHT = vec3(new_albedo_tex);
}"

[sub_resource type="CompressedTexture2D" id="CompressedTexture2D_pefem"]
load_path = "res://.godot/imported/dungeon_wall.png-b3b24cfb1e5fac94606ccee95d2d6b8c.ctex"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_lgaei"]
resource_local_to_scene = true
render_priority = 0
shader = SubResource("Shader_k7p2f")
shader_parameter/texture_albedo = SubResource("CompressedTexture2D_pefem")
shader_parameter/uv1_blend_sharpness = 1.0
shader_parameter/uv1_scale = Vector3(1.75, 1.75, 1.75)
shader_parameter/uv1_offset = Vector3(0, 0, 0)
shader_parameter/custom_colors = false
shader_parameter/color_0 = Color(0, 0, 0, 1)
shader_parameter/color_1 = Color(0, 0, 0, 1)
shader_parameter/color_2 = Color(0, 0, 0, 1)
shader_parameter/dim = 0.8

[sub_resource type="ShaderMaterial" id="ShaderMaterial_2kcmm"]
resource_local_to_scene = true
render_priority = 0
shader = SubResource("Shader_k7p2f")
shader_parameter/texture_albedo = SubResource("CompressedTexture2D_pefem")
shader_parameter/uv1_blend_sharpness = 1.0
shader_parameter/uv1_scale = Vector3(1.75, 1.75, 1.75)
shader_parameter/uv1_offset = Vector3(0, 0, 0)
shader_parameter/custom_colors = false
shader_parameter/color_0 = Color(0, 0, 0, 1)
shader_parameter/color_1 = Color(0, 0, 0, 1)
shader_parameter/color_2 = Color(0, 0, 0, 1)
shader_parameter/dim = 0.6

[sub_resource type="ShaderMaterial" id="ShaderMaterial_gt0k6"]
render_priority = 0
shader = ExtResource("2_3wdb4")
shader_parameter/texture_albedo = SubResource("CompressedTexture2D_pefem")
shader_parameter/uv1_blend_sharpness = 1.0
shader_parameter/uv1_scale = Vector3(1.75, 1.75, 1.75)
shader_parameter/uv1_offset = Vector3(0, 0, 0)
shader_parameter/custom_colors = false
shader_parameter/color_0 = Color(0, 0, 0, 1)
shader_parameter/color_1 = Color(0, 0, 0, 1)
shader_parameter/color_2 = Color(0, 0, 0, 1)
shader_parameter/dim = 0.5

[sub_resource type="ShaderMaterial" id="ShaderMaterial_5ece1"]
render_priority = 0
shader = ExtResource("2_3wdb4")
shader_parameter/texture_albedo = SubResource("CompressedTexture2D_pefem")
shader_parameter/uv1_blend_sharpness = 1.0
shader_parameter/uv1_scale = Vector3(1.75, 1.75, 1.75)
shader_parameter/uv1_offset = Vector3(0, 0, 0)
shader_parameter/custom_colors = false
shader_parameter/color_0 = Color(0, 0, 0, 1)
shader_parameter/color_1 = Color(0, 0, 0, 1)
shader_parameter/color_2 = Color(0, 0, 0, 1)
shader_parameter/dim = 0.5

[sub_resource type="ShaderMaterial" id="ShaderMaterial_d1h5x"]
render_priority = 0
shader = ExtResource("2_3wdb4")
shader_parameter/texture_albedo = SubResource("CompressedTexture2D_pefem")
shader_parameter/uv1_blend_sharpness = 1.0
shader_parameter/uv1_scale = Vector3(1.75, 1.75, 1.75)
shader_parameter/uv1_offset = Vector3(0, 0, 0)
shader_parameter/custom_colors = false
shader_parameter/color_0 = Color(0, 0, 0, 1)
shader_parameter/color_1 = Color(0, 0, 0, 1)
shader_parameter/color_2 = Color(0, 0, 0, 1)
shader_parameter/dim = 0.8

[sub_resource type="ShaderMaterial" id="ShaderMaterial_wfhu8"]
resource_local_to_scene = true
render_priority = 0
shader = SubResource("Shader_k7p2f")
shader_parameter/texture_albedo = SubResource("CompressedTexture2D_pefem")
shader_parameter/uv1_blend_sharpness = 1.0
shader_parameter/uv1_scale = Vector3(1.75, 1.75, 1.75)
shader_parameter/uv1_offset = Vector3(0, 0, 0)
shader_parameter/custom_colors = false
shader_parameter/color_0 = Color(0, 0, 0, 1)
shader_parameter/color_1 = Color(0, 0, 0, 1)
shader_parameter/color_2 = Color(0, 0, 0, 1)
shader_parameter/dim = 0.9

[node name="RoomFinal" type="Node3D"]

[node name="AnimatedLight" parent="." instance=ExtResource("1_m3vai")]
transform = Transform3D(1, 0, 0, 0, 1, 1.49012e-08, 0, -1.49012e-08, 1, 0, -1.04679, -0.340801)

[node name="CSGBox3D" type="CSGBox3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0278059, -1.4995, -5)
size = Vector3(7.15325, 0.001, 12)
material = SubResource("ShaderMaterial_lgaei")

[node name="CSGBox3D4" type="CSGBox3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.995272, 0.0971313, 0, -0.0971313, 0.995272, 0.00349149, 3.20271, -5)
size = Vector3(7.48478, 0.001, 12)
material = SubResource("ShaderMaterial_2kcmm")

[node name="CSGBox3D6" type="CSGBox3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -4.18556, 1.47394, -6.54517)
size = Vector3(1.61377, 5.94769, 6.72687)
material = SubResource("ShaderMaterial_gt0k6")

[node name="CSGBox3D3" type="CSGBox3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 4.10775, 1.46979, -6.43469)
size = Vector3(1.61377, 5.95599, 6.94781)
material = SubResource("ShaderMaterial_5ece1")

[node name="CSGBox3D16" type="CSGBox3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3.42136, 1.58432, -8.84988)
size = Vector3(1.61377, 5.94769, 1.6571)
material = SubResource("ShaderMaterial_d1h5x")

[node name="CSGBox3D17" type="CSGBox3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 3.43522, 1.58438, -8.85)
size = Vector3(1.61377, 5.94769, 1.6571)
material = SubResource("ShaderMaterial_d1h5x")

[node name="BackWall" type="Node3D" parent="."]

[node name="CSGBox3D11" type="CSGBox3D" parent="BackWall"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0999775, 1.42036, -9.75877)
size = Vector3(6.3849, 6.05486, 0.973203)
material = SubResource("ShaderMaterial_wfhu8")
